
![[Pasted image 20220315165723.png]]


### 强缓存
定义：不会向服务器发送请求，直接从缓存中读取资源。

原理：强制缓存就是向浏览器缓存查找该请求结果，并根据该结果的缓存规则来决定是否使用该缓存结果的过程 

#####  Expires
`Expires`即过期时间，存在于服务端返回的响应头中，告诉浏览器在这个过期时间之前可以直接从缓存里面获取数据，无需再次请求。

缺点：Expires 是 HTTP/1 的产物，受限于本地时间，如果修改了本地时间，可能会造成缓存失效。

##### Cache-Control
它和`Expires`本质的不同在于它并没有采用`具体的过期时间点`这个方式，而是采用过期时长来控制缓存，对应的字段是**max-age**。
主要取值为：

-   public：所有内容都将被缓存（客户端和代理服务器都可缓存）
    
-   private：所有内容只有客户端可以缓存，Cache-Control的默认取值
    
-   no-cache：客户端缓存内容，但是是否使用缓存则需要经过协商缓存来验证决定
    
-   no-store：所有内容都不会被缓存，即不使用强制缓存，也不使用协商缓存
    

#### 协商缓存（弱缓存）
##### Last-Modified
即最后修改时间。在浏览器第一次给服务器发送请求后，服务器会在响应头中加上这个字段。
浏览器接收到后，如果再次请求，会在请求头中携带`If-Modified-Since`字段，这个字段的值也就是服务器传来的最后修改时间。
服务器拿到请求头中的`If-Modified-Since`的字段后，其实会和这个服务器中`该资源的最后修改时间`对比:
-   如果请求头中的这个值小于最后修改时间，说明是时候更新了。返回新的资源，跟常规的HTTP请求响应的流程一样。
-   否则返回304，告诉浏览器直接用缓存。




##### ETag
`ETag` 是服务器根据当前文件的内容，给文件生成的唯一标识（IDKEY），只要里面的内容有改动，这个值就会变。服务器通过`响应头`把这个值给浏览器。

浏览器接收到`ETag`的值，会在下次请求时，将这个值作为**If-None-Match**这个字段的内容，并放到请求头中，然后发给服务器。





## 缓存位置










#### 总结

首先通过 `Cache-Control` 验证强缓存是否可用

-   如果强缓存可用，直接使用
-   否则进入协商缓存，即发送 HTTP 请求，服务器通过请求头中的`If-Modified-Since`或者`If-None-Match`这些条件请求字段检查资源是否更新
    -   若资源更新，返回资源和200状态码
    -   否则，返回304，告诉浏览器直接从缓存获取资源

[# 彻底弄懂浏览器缓存策略](https://www.jiqizhixin.com/articles/2020-07-24-12)
[# 彻底理解浏览器的缓存机制](https://juejin.cn/post/6844903593275817998)
[谈谈缓存](https://sanyuan0704.top/blogs/perform/001.html#%E5%BC%BA%E7%BC%93%E5%AD%98)
[# 浏览器缓存看这一篇就够了](https://zhuanlan.zhihu.com/p/60950750)