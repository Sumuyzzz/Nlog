## 什么是闭包

JavaScript高级程序解释

> 闭包指的是那些引用了另一个函数作用域中变量的函数,通常是嵌套函数中实现的

mdn解释

> 函数跟其词法环境的引用捆绑在一起,这样的组合叫闭包



用我自己的话来讲

当一个嵌套的函数在定义(作用域)的外面被访问，以至它可以在外部函数返回后被执行，此时一个闭包形成。



MDN的经典闭包例子

```js
function init() {
    var name = "Mozilla"; // name 是一个被 init 创建的局部变量
    function displayName() { // displayName() 是内部函数，一个闭包
        alert(name); // 使用了父函数中声明的变量
    }
   return displayName;
}
let Closures = init();
Closures()
```

这里的`name`就是自由变量,`init`就是一个局部的作用域,

执行`Closures()`就是在执行`displayName()`,但是`init()`并没有执行,直接执行嵌套函`isplayName()`,

,闭包在定义的那一刻已经存在,所以自由变量`name`就会存在于嵌套函数里,外部状态拷贝一份在内部环境里





## 闭包详解



[ stackoverflow 闭包是如何工作](https://stackoverflow.com/questions/111102/how-do-javascript-closures-work)

* 内部函数可以访问函数外面的变量
* 返回值为函数

**JavaScript 闭包的本质源自两点，词法作用域和函数当作值传递。**

词法作用域，就是，按照代码书写时的样子，内部函数可以访问函数外面的变量。

![image-20210704150548490](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210704150548490.png)



**当函数可以记住并访问所在的词法作用域，即使函数是在当前词法作用域之外执行，这就产生了闭包。** ----《你不知道的Javascript上卷》

我个人理解，**闭包就是函数中的函数(其他语言不能函数再套函数)**,里面的函数可以访问外面函数的变量，外面的变量的是这个内部函数的一部分。

```js
  function f1(){
   var a = 999;
   function f2(){
    console.log(a);
   }
   return f2; // f1返回了f2的引用
   }
   var result = f1(); // result就是f2函数了
   result();  // 执行result，全局作用域下没有a的定义，
         //但是函数闭包，能够把定义函数的时候的作用域一起记住，输出999	
```

上面代码中，函数f1的返回值就是函数f2，由于f2可以读取f1的内部变量，所以就可以在外部获得f1的内部变量了。

闭包就是函数f2，即能够读取其他函数内部变量的函数。由于在JavaScript语言中，只有函数内部的子函数才能读取内部变量，因此可以把闭包简单理解成“定义在一个函数内部的函数”。**闭包最大的特点，就是它可以“记住”诞生的环境，比如f2记住了它诞生的环境f1，所以从f2可以得到f1的内部变量**。在本质上，闭包就是将函数内部和函数外部连接起来的一座桥梁。



```js
function count() {
    var arr = [];
    for (var i=1; i<=3; i++) {
        arr.push(function () {
            return i * i;
        });
    }
    return arr;
}

var results = count();
var f1 = results[0];
var f2 = results[1];
var f3 = results[2];
f1(); // 16
f2(); // 16
f3(); // 16


```









返回闭包时牢记的一点就是：返回函数不要引用任何循环变量，或者后续会发生变化的变量。







**不再用到的内存，没有及时释放，就叫做内存泄漏（memory leak）**

*闭包*是由函数以及声明该函数的词法环境组合而成的











## 什么是闭包

首先先说明一点，闭包跟立即执行函数没有任何联系，**只是立即执行函数比较好模拟闭包的特性**，就是直接无法访问修改



## 举例子：

把每个对象看作成平行宇宙，而闭包就是穿梭在平行宇宙之间的黑洞

## 实现：

```js
const obj =function(){
    let x = 0;
    function func(){
        x=x+1
        console.log(x)
    }
    return func
}

const addX = obj()




```



### 累加器：

闭包的字面意思说的很清楚，就是**”闭“**和**“包”**，本质把一些变量封闭起来，闭包定义好的，无法访问修改的（实际上是无法按访问的，但立即执行函数比较好模拟这个无法访问的闭包），也就是封闭的包裹对象，简称闭包，只有addX是给你使用的。

```js
function closure(){
    let x = 0;
    function func(){
        x=x+1
        console.log(x)
    }
    return func
}


const addX = closure()


//这是给你用的
addX()
```















